<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/5a99eaa8df53ec8d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5a99eaa8df53ec8d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a29ed70e1ad7f7ff.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a29ed70e1ad7f7ff.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-71e149bd9a6f2c0d.js" defer=""></script><script src="/_next/static/chunks/framework-3b7283d6a8166ac6.js" defer=""></script><script src="/_next/static/chunks/main-e30ba8f4087d3abf.js" defer=""></script><script src="/_next/static/chunks/pages/_app-64effea832d81a80.js" defer=""></script><script src="/_next/static/chunks/494-025a33dbdf652f45.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-974ce2c1819e19ab.js" defer=""></script><script src="/_next/static/-wqAawdWiK2u4Hfp8IHzT/_buildManifest.js" defer=""></script><script src="/_next/static/-wqAawdWiK2u4Hfp8IHzT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div data-theme="cyberpunk"><div class="bg-base-200"><nav class="sticky top-0 z-10 py-3 border-b-2 border-neutral bg-base-100"><main class="flex items-center justify-between w-full px-5"><h3 class="text-lg md:text-2xl font-bold text-primary cursor-pointer"><a href="/">elanmed.dev</a></h3><div><span class="hidden mr-4 text-xs sm:inline">check out my blog! <span class="text-lg text-primary">→</span></span><span class="cursor-pointer select-none hover:underline hover:text-primary transition"><a href="/blog">blog</a></span></div></main></nav><main class="min-h-screen w-full max-w-5xl m-auto py-6 bg-base-100 px-2 md:px-20"><div><div class="pb-2 mb-8 text-sm italic border-b-2 text-primary border-b-base-300 w-max">last updated: <!-- -->July 27, 2022</div><div class="markdown_markdown__28kdH"><h1>Data Fetching in React: Parent-Agnostic vs Parent-Dependent Children</h1>
<p>Data fetching in React is a popular topic of blog posts, dev talks, and tutorials – and for good reason. Asynchronous data fetching introduces a whole collection of complexities to handle. I hope to contribute with a less-often discussed topic: the role of the children whose parent fetches data asynchronously, and to what extent the children should account for this behavior.</p>
<h2>Preamble: basic inline null checking</h2>
<p>Take the following snippet:</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">interface</span><span> </span><span class="token class-name maybe-class-name">Data</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  price</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token function-variable" style="color:#ffc66d">load</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#cc7832">async</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#cc7832">try</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">const</span><span> data</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token maybe-class-name">Data</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token control-flow" style="color:#cc7832">await</span><span> </span><span class="token" style="color:#ffc66d">getData</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>        </span><span class="token" style="color:#ffc66d">setData</span><span class="token" style="color:#a9b7c6">(</span><span>data</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">}</span><span> </span><span class="token control-flow" style="color:#cc7832">catch</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>e</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>        </span><span class="token console class-name">console</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">error</span><span class="token" style="color:#a9b7c6">(</span><span>e</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>      </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>    </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>    </span><span class="token" style="color:#ffc66d">load</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>Now consider a case where the <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">Parent</code> wants to render markup based on the data fetched with <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">getData</code>.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// ...</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>data</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">price</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>Because a <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">useEffect</code> runs <em>after</em> the render, there&#x27;s at least one render (i.e. the first) where <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data</code> is still its initial value, <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">null</code>. This means, one way or another, we have to account for a <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">null</code> instance of <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data</code> – otherwise, React will crash when we try to access <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">(null).number</code>.</p>
<div data-daisy="alert">
<p>I&#x27;d highly recommend checking out Dan Abramov&#x27;s <a href="https://overreacted.io/a-complete-guide-to-useeffect/">A Complete Guide to useEffect</a> <span data-daisy="aside">[external link]</span> if the mechanics of <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">useEffect</code> aren&#x27;t so clear to you.</p>
</div>
<p>One popular option is to perform inline null checking.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// ...</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>data</span><span class="token" style="color:#a9b7c6">?.</span><span>price</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>With optional chaining in place, when <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data</code> is <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">null</code>, accessing <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data?.price</code> will return <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code> instead of throwing an error. This pattern takes advantage of the fact that, if an expression passed to a <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">{}</code> in React &quot;resolves&quot; to <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">null</code> or <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code>, React will gracefully (i.e. without throwing an error) render nothing.</p>
<h2>A more complicated case</h2>
<p>Optional chaining works fine for simple cases like above, but what about when we want to perform actions on the data that depend on its type? Consider if we&#x27;d like to format the <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">price</code> field to two decimal places:</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// ...</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>data</span><span class="token" style="color:#a9b7c6">?.</span><span>price</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">toFixed</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>Since <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data</code> will be null on the first render, <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data?.price</code> will resolve to <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code>, and we&#x27;ll end up calling <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">(undefined).toFixed(2)</code>, which&#x27;ll throw.</p>
<p>Simple enough, let&#x27;s add a fallback value of <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">0</code>:</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">(</span><span>data</span><span class="token" style="color:#a9b7c6">?.</span><span>price </span><span class="token" style="color:#a9b7c6">??</span><span> </span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">toFixed</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span></code></div></pre>
<p>Alternatively, we could return early and avoid our optional chaining altogether:</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// ...</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>data </span><span class="token" style="color:#a9b7c6">===</span><span> </span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token control-flow" style="color:#cc7832">return</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>data</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">price</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">toFixed</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>Either solution works great when we&#x27;re dealing with a single component, but once we introduce children into the mix, we encounter some deeper questions. Consider our original example, but with a new <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">FormatNumber</code> child.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// ...</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token class-name" style="color:#e8bf6a">FormatNumber</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#a9b7c6">num</span><span class="token script language-javascript script-punctuation" style="color:#e8bf6a">=</span><span class="token script language-javascript" style="color:#e8bf6a">{</span><span class="token script language-javascript" style="color:#e8bf6a">data</span><span class="token script language-javascript" style="color:#a9b7c6">?.</span><span class="token script language-javascript" style="color:#e8bf6a">price</span><span class="token script language-javascript" style="color:#e8bf6a">}</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#e8bf6a">/&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">FormatNumber</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span> num </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span> num</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>num</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">toFixed</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>As explained above, this code will crash on the first render when <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data?.price</code> resolves to <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code>, and we pass <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code> as <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">num</code> to <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">FormatNumber</code>.</p>
<p>There are three possible fixes, two of which we already discussed:</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// ...</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#808080">// option 1 (old: return early)</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>data </span><span class="token" style="color:#a9b7c6">===</span><span> </span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token control-flow" style="color:#cc7832">return</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token class-name" style="color:#e8bf6a">FormatNumber</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#a9b7c6">num</span><span class="token script language-javascript script-punctuation" style="color:#e8bf6a">=</span><span class="token script language-javascript" style="color:#e8bf6a">{</span><span class="token script language-javascript" style="color:#e8bf6a">data</span><span class="token script language-javascript" style="color:#e8bf6a">.</span><span class="token script language-javascript property-access" style="color:#e8bf6a">price</span><span class="token script language-javascript" style="color:#e8bf6a">}</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#e8bf6a">/&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#808080">// option 2 (old: inline null checking with a fallback value)</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token class-name" style="color:#e8bf6a">FormatNumber</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#a9b7c6">num</span><span class="token script language-javascript script-punctuation" style="color:#e8bf6a">=</span><span class="token script language-javascript" style="color:#e8bf6a">{</span><span class="token script language-javascript" style="color:#e8bf6a">data</span><span class="token script language-javascript" style="color:#a9b7c6">?.</span><span class="token script language-javascript" style="color:#e8bf6a">price </span><span class="token script language-javascript" style="color:#a9b7c6">??</span><span class="token script language-javascript" style="color:#e8bf6a"> </span><span class="token script language-javascript" style="color:#6897bb">0</span><span class="token script language-javascript" style="color:#e8bf6a">}</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#e8bf6a">/&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">FormatNumber</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span> num </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span> num</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#808080">// option 3 (new: null checking in the child)</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">typeof</span><span> num </span><span class="token" style="color:#a9b7c6">!==</span><span> </span><span class="token" style="color:#6a8759">&quot;number&quot;</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token control-flow" style="color:#cc7832">return</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>num</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">toFixed</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>Now that we&#x27;re dealing with two components, we have the option to null check in the parent <em>or</em> in the child – option 1 and option 2 null check in parent, and option 3 null checks in the child. This leads us to a deeper, more interesting question on best-practices:</p>
<p><strong>Who should be responsible for null checking?</strong> The parent, or the child? This question is at the crux of this article; let&#x27;s explore both approaches.</p>
<h2>Parent-dependent children</h2>
<p>A Parent-dependent child relies on it&#x27;s parent to do it&#x27;s null checking for them. It has no null checking of it&#x27;s own, and it expects it&#x27;s props to always be populated and of the correct type. Otherwise, it may throw.</p>
<p>In our example above, this would mean the <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">Parent</code> should return early, ensuring that when <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">FormatNumber</code> <em>is</em> rendered, its <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">num</code> prop is always populated and a <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">number</code>.
Alternatively, the <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">Parent</code> could perform inline null checking with a fallback value and achieve the same result.</p>
<p>It&#x27;s worth nothing that if the child&#x27;s prop is a more complicated data structure, such as a series of nested objects, passing a fallback value like <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">?? 0</code> isn&#x27;t always an option.</p>
<h2>Parent-agnostic children</h2>
<p>In contrast to a Parent-dependent child, a Parent-agnostic child expects no null checking from it&#x27;s parent. Maybe the parent will null check before rendering the child, maybe it won&#x27;t - the Parent-agnostic child won&#x27;t rely on either behavior. Instead, the Parent-agnostic child will perform it&#x27;s own null checking, gracefully handling every case on its own.</p>
<p>In our example above, <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">FormatNumber</code> would have its own null checking, maybe something like:</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">FormatNumber</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span> num</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">if</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">typeof</span><span> num </span><span class="token" style="color:#a9b7c6">!==</span><span> </span><span class="token" style="color:#6a8759">&quot;number&quot;</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token control-flow" style="color:#cc7832">return</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>num</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">toFixed</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<div data-daisy="alert">
<p><strong>Note</strong>: when null checking a number or string, a simple <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">if (!prop)</code> check is mostly likely <em>not</em> what you want – it will return <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">false</code> with <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">0</code> or <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">&quot;&quot;</code>!</p>
</div>
<h2>So which is best?</h2>
<p>I would argue that, in an ideal world, we would all write Parent-dependent children. The child shouldn&#x27;t have to worry about being passed nullish (<code class="inline-block px-3 py-0 text-sm rounded bg-base-300">null</code> or <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code>) values: it clearly defines that it expects non-nullish props in its type! If you&#x27;re consuming an api (i.e. a child component) in your parent, it should be <em>your</em> responsibility to call that child with the props it expects.</p>
<p>Unfortunately, this approach isn&#x27;t always feasible. In the same way we&#x27;re taught to never trust, and always validate, user input, the author of a child component should never expect that the parent will call it correctly. Anything else would be much too optimistic.</p>
<p>But what if there was a way for the child to guarantee that the parent would pass it the correct props, without needing any extra code to verify the fact? It seems to0 good to be true, but that&#x27;s exactly what we can do with <a href="https://www.typescriptlang.org/tsconfig#strictNullChecks"><code class="inline-block px-3 py-0 text-sm rounded bg-base-300">strictNullChecks</code></a> enabled.</p>
<h2>strict null checks</h2>
<p>In the words of the TypeScript docs:</p>
<div data-daisy="alert">
<p>When <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">strictNullChecks</code> is <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">true</code>, <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">null</code> and <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code> have their own distinct types and you’ll get a type error if you try to use them where a concrete value is expected.</p>
</div>
<p>With <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">strictNullChecks</code> enabled, let&#x27;s go back to our example and try to perform inline null checking in the parent:</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-tsx" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">Parent</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">const</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> setData</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token generic-function" style="color:#ffc66d">useState</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&lt;</span><span class="token generic-function generic class-name maybe-class-name">Data</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name" style="color:#a9b7c6">|</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name null nil" style="color:#cc7832">null</span><span class="token generic-function generic class-name" style="color:#a9b7c6">&gt;</span><span class="token" style="color:#a9b7c6">(</span><span class="token null nil" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#ffc66d">useEffect</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token arrow" style="color:#a9b7c6">=&gt;</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>    </span><span class="token" style="color:#808080">// ...</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span><span>
</span>
<span>  </span><span class="token" style="color:#808080">/*
</span><span class="token" style="color:#808080">   Compile time ts error:
</span><span class="token" style="color:#808080">   Type &#x27;number | undefined&#x27; is not assignable to type &#x27;number&#x27;.
</span><span class="token" style="color:#808080">      Type &#x27;undefined&#x27; is not assignable to type &#x27;number&#x27;.
</span><span class="token" style="color:#808080">  */</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token class-name" style="color:#e8bf6a">FormatNumber</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#a9b7c6">num</span><span class="token script language-javascript script-punctuation" style="color:#e8bf6a">=</span><span class="token script language-javascript" style="color:#e8bf6a">{</span><span class="token script language-javascript" style="color:#e8bf6a">data</span><span class="token script language-javascript" style="color:#a9b7c6">?.</span><span class="token script language-javascript" style="color:#e8bf6a">id</span><span class="token script language-javascript" style="color:#e8bf6a">}</span><span class="token" style="color:#e8bf6a"> </span><span class="token" style="color:#e8bf6a">/&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span></span><span class="token" style="color:#808080">// Parent-dependent variation (without it&#x27;s own null checks)</span><span>
</span><span></span><span class="token" style="color:#cc7832">function</span><span> </span><span class="token maybe-class-name" style="color:#ffc66d">FormatNumber</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span> num</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#e8bf6a">number</span><span> </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#e8bf6a">&lt;</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">{</span><span>num</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">toFixed</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#e8bf6a">&lt;/</span><span class="token" style="color:#e8bf6a">&gt;</span><span class="token" style="color:#a9b7c6">;</span><span>
</span><span></span><span class="token" style="color:#a9b7c6">}</span></code></div></pre>
<p>TypeScript now gives us a compile time error that <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">data?.id</code> may be <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">undefined</code>, and <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">FormatNumber</code>&#x27;s <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">num</code> prop can only be a <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">number</code>!</p>
<p>To fix this error, we can either return early, or modify our inline null checking to use a fallback value.</p>
<p>It&#x27;s important to note that, from the perspective of the parent, little has changed: you still have to return early or perform inline null checking. TypeScript won&#x27;t save you any code, or advise you to choose one over the other. All of that&#x27;s true.</p>
<p>But from the perspective of the child, this makes a <em>huge</em> difference. With <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">strictNullChecks</code> enabled, the child can have the clean code of a Parent-dependent child (i.e. without any null checks of its own) with the safety guarantees of a Parent-agnostic child – if a parent tries to pass the child a prop not explicitly described in the child&#x27;s type (like a nullish prop), TypeScript will throw an error!</p>
<h2>When strict null checks aren&#x27;t available</h2>
<p><code class="inline-block px-3 py-0 text-sm rounded bg-base-300">strictNullChecks</code> are a great solution when your codebase in written in TypeScript, but for when you&#x27;re working in JavaScript, or for one reason or another you have to keep <code class="inline-block px-3 py-0 text-sm rounded bg-base-300">strictNullChecks</code> disabled, there are a few considerations I try to keep in mind when deciding between writing Parent-dependent and Parent-agnostic children.</p>
<p>Is the child a general-purpose component designed to be used by multiple parents, or a one-off written for a single case? If the former, I tend to air on the side of writing Parent-agnostic children – as we discussed above, it&#x27;s best not to rely on a consumer of your component null checking for you (whether that be yourself or someone else working on the codebase).</p>
<p>On the other hand, if the child is only used by a single parent, that may be a better case for writing a Parent-dependent child. The mental effort of remembering to pass non-nullish values to the child (either by returning early, or passing a fallback value when performing inline null checking), may be worth the code saved by making the child Parent-dependent.</p>
<p>It&#x27;s not ideal, but for situations where we have to rely on best practices instead of compile-time checks, all you can do is use your best judgement.</p></div><div class="w-1/2 divider"></div><div><p class="mb-3 text-sm italic text-primary">you may also like:</p><div class="max-w-[500px] cursor-pointer rounded-2xl flex items-center p-3 gap-3 border-base-100 border-2 hover:border-primary"><div class=""><h2 class="font-semibold mb-1">Data Fetching in React: Parent-Agnostic vs Parent-Dependent Children</h2><p class="text-xs italic mb-2">July 27, 2022</p><p class="text-xs mb-2">Null checking: who should have to do it? The child, or the parent?</p><div><span class="bg-secondary text-secondary-content rounded-full px-4 py-1 text-xs mr-1">react</span><span class="bg-secondary text-secondary-content rounded-full px-4 py-1 text-xs mr-1">software eng</span></div></div></div></div></div></main><footer class="flex justify-center py-4 text-xs border-t-base-300 border-t bg-base-100"><span>© elan medoff</span></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"content":"\n# Data Fetching in React: Parent-Agnostic vs Parent-Dependent Children\n\nData fetching in React is a popular topic of blog posts, dev talks, and tutorials – and for good reason. Asynchronous data fetching introduces a whole collection of complexities to handle. I hope to contribute with a less-often discussed topic: the role of the children whose parent fetches data asynchronously, and to what extent the children should account for this behavior.\n\n## Preamble: basic inline null checking\n\nTake the following snippet:\n\n```tsx\ninterface Data {\n  price: number;\n}\n\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    const load = async () =\u003e {\n      try {\n        const data: Data = await getData();\n        setData(data);\n      } catch (e) {\n        console.error(e);\n      }\n    };\n\n    load();\n  }, []);\n\n  return null;\n}\n```\n\nNow consider a case where the `Parent` wants to render markup based on the data fetched with `getData`.\n\n```tsx\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    // ...\n  }, []);\n\n  return \u003c\u003e{data.price}\u003c/\u003e;\n}\n```\n\nBecause a `useEffect` runs _after_ the render, there's at least one render (i.e. the first) where `data` is still its initial value, `null`. This means, one way or another, we have to account for a `null` instance of `data` – otherwise, React will crash when we try to access `(null).number`.\n\n\u003cdiv data-daisy=\"alert\"\u003e\n\nI'd highly recommend checking out Dan Abramov's [A Complete Guide to useEffect](https://overreacted.io/a-complete-guide-to-useeffect/) \u003cspan data-daisy=\"aside\"\u003e[external link]\u003c/span\u003e if the mechanics of `useEffect` aren't so clear to you.\n\n\u003c/div\u003e\n\nOne popular option is to perform inline null checking.\n\n```tsx\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    // ...\n  }, []);\n\n  return \u003c\u003e{data?.price}\u003c/\u003e;\n}\n```\n\nWith optional chaining in place, when `data` is `null`, accessing `data?.price` will return `undefined` instead of throwing an error. This pattern takes advantage of the fact that, if an expression passed to a `{}` in React \"resolves\" to `null` or `undefined`, React will gracefully (i.e. without throwing an error) render nothing.\n\n## A more complicated case\n\nOptional chaining works fine for simple cases like above, but what about when we want to perform actions on the data that depend on its type? Consider if we'd like to format the `price` field to two decimal places:\n\n```tsx\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    // ...\n  }, []);\n\n  return \u003c\u003e{data?.price.toFixed(2)}\u003c/\u003e;\n}\n```\n\nSince `data` will be null on the first render, `data?.price` will resolve to `undefined`, and we'll end up calling `(undefined).toFixed(2)`, which'll throw.\n\nSimple enough, let's add a fallback value of `0`:\n\n```tsx\nreturn \u003c\u003e{(data?.price ?? 0).toFixed(2)}\u003c/\u003e;\n```\n\nAlternatively, we could return early and avoid our optional chaining altogether:\n\n```tsx\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    // ...\n  }, []);\n\n  if (data === null) return;\n\n  return \u003c\u003e{data.price.toFixed(2)}\u003c/\u003e;\n}\n```\n\nEither solution works great when we're dealing with a single component, but once we introduce children into the mix, we encounter some deeper questions. Consider our original example, but with a new `FormatNumber` child.\n\n```tsx\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    // ...\n  }, []);\n\n  return \u003cFormatNumber num={data?.price} /\u003e;\n}\n\nfunction FormatNumber({ num }: { num: number }) {\n  return \u003c\u003e{num.toFixed(2)}\u003c/\u003e;\n}\n```\n\nAs explained above, this code will crash on the first render when `data?.price` resolves to `undefined`, and we pass `undefined` as `num` to `FormatNumber`.\n\nThere are three possible fixes, two of which we already discussed:\n\n```tsx\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    // ...\n  }, []);\n\n  // option 1 (old: return early)\n  if (data === null) return;\n  return \u003cFormatNumber num={data.price} /\u003e;\n\n  // option 2 (old: inline null checking with a fallback value)\n  return \u003cFormatNumber num={data?.price ?? 0} /\u003e;\n}\n\nfunction FormatNumber({ num }: { num: number }) {\n  // option 3 (new: null checking in the child)\n  if (typeof num !== \"number\") return;\n  return \u003c\u003e{num.toFixed(2)}\u003c/\u003e;\n}\n```\n\nNow that we're dealing with two components, we have the option to null check in the parent _or_ in the child – option 1 and option 2 null check in parent, and option 3 null checks in the child. This leads us to a deeper, more interesting question on best-practices:\n\n**Who should be responsible for null checking?** The parent, or the child? This question is at the crux of this article; let's explore both approaches.\n\n## Parent-dependent children\n\nA Parent-dependent child relies on it's parent to do it's null checking for them. It has no null checking of it's own, and it expects it's props to always be populated and of the correct type. Otherwise, it may throw.\n\nIn our example above, this would mean the `Parent` should return early, ensuring that when `FormatNumber` _is_ rendered, its `num` prop is always populated and a `number`.\nAlternatively, the `Parent` could perform inline null checking with a fallback value and achieve the same result.\n\nIt's worth nothing that if the child's prop is a more complicated data structure, such as a series of nested objects, passing a fallback value like `?? 0` isn't always an option.\n\n## Parent-agnostic children\n\nIn contrast to a Parent-dependent child, a Parent-agnostic child expects no null checking from it's parent. Maybe the parent will null check before rendering the child, maybe it won't - the Parent-agnostic child won't rely on either behavior. Instead, the Parent-agnostic child will perform it's own null checking, gracefully handling every case on its own.\n\nIn our example above, `FormatNumber` would have its own null checking, maybe something like:\n\n```tsx\nfunction FormatNumber({ num: number }) {\n  if (typeof num !== \"number\") return;\n  return \u003c\u003e{num.toFixed(2)}\u003c/\u003e;\n}\n```\n\n\u003cdiv data-daisy=\"alert\"\u003e\n\n**Note**: when null checking a number or string, a simple `if (!prop)` check is mostly likely _not_ what you want – it will return `false` with `0` or `\"\"`!\n\n\u003c/div\u003e\n\n## So which is best?\n\nI would argue that, in an ideal world, we would all write Parent-dependent children. The child shouldn't have to worry about being passed nullish (`null` or `undefined`) values: it clearly defines that it expects non-nullish props in its type! If you're consuming an api (i.e. a child component) in your parent, it should be _your_ responsibility to call that child with the props it expects.\n\nUnfortunately, this approach isn't always feasible. In the same way we're taught to never trust, and always validate, user input, the author of a child component should never expect that the parent will call it correctly. Anything else would be much too optimistic.\n\nBut what if there was a way for the child to guarantee that the parent would pass it the correct props, without needing any extra code to verify the fact? It seems to0 good to be true, but that's exactly what we can do with [`strictNullChecks`](https://www.typescriptlang.org/tsconfig#strictNullChecks) enabled.\n\n## strict null checks\n\nIn the words of the TypeScript docs:\n\n\u003cdiv data-daisy=\"alert\"\u003e\n\nWhen `strictNullChecks` is `true`, `null` and `undefined` have their own distinct types and you’ll get a type error if you try to use them where a concrete value is expected.\n\n\u003c/div\u003e\n\nWith `strictNullChecks` enabled, let's go back to our example and try to perform inline null checking in the parent:\n\n```tsx\nfunction Parent() {\n  const [data, setData] = useState\u003cData | null\u003e(null);\n\n  useEffect(() =\u003e {\n    // ...\n  }, []);\n\n  /*\n   Compile time ts error:\n   Type 'number | undefined' is not assignable to type 'number'.\n      Type 'undefined' is not assignable to type 'number'.\n  */\n  return \u003cFormatNumber num={data?.id} /\u003e;\n}\n\n// Parent-dependent variation (without it's own null checks)\nfunction FormatNumber({ num: number }) {\n  return \u003c\u003e{num.toFixed(2)}\u003c/\u003e;\n}\n```\n\nTypeScript now gives us a compile time error that `data?.id` may be `undefined`, and `FormatNumber`'s `num` prop can only be a `number`!\n\nTo fix this error, we can either return early, or modify our inline null checking to use a fallback value.\n\nIt's important to note that, from the perspective of the parent, little has changed: you still have to return early or perform inline null checking. TypeScript won't save you any code, or advise you to choose one over the other. All of that's true.\n\nBut from the perspective of the child, this makes a _huge_ difference. With `strictNullChecks` enabled, the child can have the clean code of a Parent-dependent child (i.e. without any null checks of its own) with the safety guarantees of a Parent-agnostic child – if a parent tries to pass the child a prop not explicitly described in the child's type (like a nullish prop), TypeScript will throw an error!\n\n## When strict null checks aren't available\n\n`strictNullChecks` are a great solution when your codebase in written in TypeScript, but for when you're working in JavaScript, or for one reason or another you have to keep `strictNullChecks` disabled, there are a few considerations I try to keep in mind when deciding between writing Parent-dependent and Parent-agnostic children.\n\nIs the child a general-purpose component designed to be used by multiple parents, or a one-off written for a single case? If the former, I tend to air on the side of writing Parent-agnostic children – as we discussed above, it's best not to rely on a consumer of your component null checking for you (whether that be yourself or someone else working on the codebase).\n\nOn the other hand, if the child is only used by a single parent, that may be a better case for writing a Parent-dependent child. The mental effort of remembering to pass non-nullish values to the child (either by returning early, or passing a fallback value when performing inline null checking), may be worth the code saved by making the child Parent-dependent.\n\nIt's not ideal, but for situations where we have to rely on best practices instead of compile-time checks, all you can do is use your best judgement.\n","metadata":{"title":"Data Fetching in React: Parent-Agnostic vs Parent-Dependent Children","abstract":"Null checking: who should have to do it? The child, or the parent?","lastUpdated":"July 27, 2022","slug":"Parent-dependent-and-parent-agnostic-children","tags":["react","software eng"]}},"relatedPostMetadata":{"title":"Data Fetching in React: Parent-Agnostic vs Parent-Dependent Children","abstract":"Null checking: who should have to do it? The child, or the parent?","lastUpdated":"July 27, 2022","slug":"Parent-dependent-and-parent-agnostic-children","tags":["react","software eng"]}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"parent-dependent-and-parent-agnostic-children"},"buildId":"-wqAawdWiK2u4Hfp8IHzT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>